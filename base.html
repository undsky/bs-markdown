<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">

        <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
        Remove this if you use the .htaccess -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <title>base</title>
        <meta name="description" content="">
        <meta name="author" content="jyx">

        <meta name="viewport" content="width=device-width; initial-scale=1.0">

        <!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
        <link rel="shortcut icon" href="/favicon.ico">
        <link rel="apple-touch-icon" href="/apple-touch-icon.png">

        <link href="http://cdn.bootcss.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
        <link href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
        <style type="text/css">
			.fa-header:before {
				content: 'H';
				font-family: arial, sans-serif;
				font-weight: bold;
			}

			#bsmd {
				width: 100%;
				height: 100%;
			}

			#bsmd .bsmd-editor {
				position: absolute;
				top: 40px;
				right: 50%;
				bottom: 0;
				left: 0;
			}

			#bsmd .bsmd-preview {
				position: absolute;
				top: 40px;
				right: 0;
				bottom: 0;
				left: 50%;
			}
        </style>
    </head>

    <body>
        <div id="bsmd">
            <div class="btn-toolbar" role="toolbar">
                <div class="btn-group">
                    <button type="button" class="btn btn-default bsmd-btn-bold" title="粗体">
                        <i class="fa fa-bold"></i>
                    </button>
                    <button type="button" class="btn btn-default bsmd-btn-italic" title="斜体">
                        <i class="fa fa-italic"></i>
                    </button>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-default" title="链接" data-toggle="modal" data-target="#bsmd-modal-link">
                        <i class="fa fa-link"></i>
                    </button>
                    <form class="form-horizontal bsmd-form-link modal fade" id="bsmd-modal-link" role="dialog" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                        &times;
                                    </button>
                                    <h4 class="modal-title">链接</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="form-group">
                                        <label for="bsmd-link-title" class="col-sm-2 control-label">标题：</label>
                                        <div class="col-sm-10">
                                            <input type="text" name="title" class="form-control" id="bsmd-link-title" placeholder="标题">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="bsmd-link-url" class="col-sm-2 control-label">网址：</label>
                                        <div class="col-sm-10">
                                            <input type="text" name="url" value="http://" class="form-control" id="bsmd-link-url" placeholder="网址">
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">
                                        关闭
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        确定
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                    <button type="button" class="btn btn-default bsmd-btn-quote" title="引用">
                        <i class="fa fa-quote-left"></i>
                    </button>
                    <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="代码">
                            <i class="fa fa-code"></i>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li>
                                <a lang="none" class="bsmd-code" href="javascript:void(0);">片段</a>
                            </li>
                            <li>
                                <a lang="html" class="bsmd-code" href="javascript:void(0);">html</a>
                            </li>
                            <li>
                                <a lang="css" class="bsmd-code" href="javascript:void(0);">css</a>
                            </li>
                            <li>
                                <a lang="javascript" class="bsmd-code" href="javascript:void(0);">javascript</a>
                            </li>
                            <li>
                                <a lang="markdown" class="bsmd-code" href="javascript:void(0);">markdown</a>
                            </li>
                            <li>
                                <a lang="php" class="bsmd-code" href="javascript:void(0);">php</a>
                            </li>
                            <li>
                                <a lang="csharp" class="bsmd-code" href="javascript:void(0);">c#</a>
                            </li>
                            <li>
                                <a lang="velocity" class="bsmd-code" href="javascript:void(0);">velocity</a>
                            </li>
                        </ul>
                    </div>
                    <button type="button" class="btn btn-default" title="图片" data-toggle="modal" data-target="#bsmd-modal-picture">
                        <i class="fa fa-picture-o"></i>
                    </button>
                    <form class="form-horizontal bsmd-form-picture modal fade" id="bsmd-modal-picture" role="dialog" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                        &times;
                                    </button>
                                    <h4 class="modal-title">图片</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="form-group">
                                        <label for="bsmd-picture-title" class="col-sm-2 control-label">标题：</label>
                                        <div class="col-sm-10">
                                            <input type="text" name="title" class="form-control" id="bsmd-picture-title" placeholder="标题">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="bsmd-picture-url" class="col-sm-2 control-label">网址：</label>
                                        <div class="col-sm-10">
                                            <input type="text" name="url" value="http://" class="form-control" id="bsmd-picture-url" placeholder="网址">
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">
                                        关闭
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        确定
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-default bsmd-btn-ol" title="有序列表">
                        <i class="fa fa-list-ol"></i>
                    </button>
                    <button type="button" class="btn btn-default bsmd-btn-ul" title="无序列表">
                        <i class="fa fa-list-ul"></i>
                    </button>
                    <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="标题">
                            <i class="fa fa-header"></i>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="bsmd-header" href="javascript:void(0);"><i class="fa fa-header"></i>1</a>
                            </li>
                            <li>
                                <a class="bsmd-header" href="javascript:void(0);"><i class="fa fa-header"></i>2</a>
                            </li>
                            <li>
                                <a class="bsmd-header" href="javascript:void(0);"><i class="fa fa-header"></i>3</a>
                            </li>
                            <li>
                                <a class="bsmd-header" href="javascript:void(0);"><i class="fa fa-header"></i>4</a>
                            </li>
                            <li>
                                <a class="bsmd-header" href="javascript:void(0);"><i class="fa fa-header"></i>5</a>
                            </li>
                            <li>
                                <a class="bsmd-header" href="javascript:void(0);"><i class="fa fa-header"></i>6</a>
                            </li>
                        </ul>
                    </div>
                    <button type="button" class="btn btn-default bsmd-btn-ellipsis" title="分割线">
                        <i class="fa fa-ellipsis-h"></i>
                    </button>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-default bsmd-btn-undo" title="撤消">
                        <i class="fa fa-undo"></i>
                    </button>
                    <button type="button" class="btn btn-default bsmd-btn-redo" title="重置">
                        <i class="fa fa-repeat"></i>
                    </button>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-default bsmd-btn-eye" title="预览">
                        <i class="fa fa-eye"></i>
                    </button>
                </div>
            </div>
            <div class="bsmd-editor"></div>
            <div class="bsmd-preview"></div>
        </div>
        <!--[if lt IE 9]>
        <script src="http://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
        <![endif]-->
        <!--[if gte IE 9]><!-->
        <script src="http://cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
        <!--<![endif]-->
        <script src="http://cdn.bootcss.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="http://cdn.bootcss.com/ace/1.1.3/ace.js"></script>
        <script type="text/javascript" src="js/marked.js"></script>
        <script type="text/javascript">
			var editor = ace.edit($('#bsmd .bsmd-editor')[0]);
			editor.setTheme('ace/theme/chrome');
			editor.getSession().setMode('ace/mode/markdown');
			editor.on('change', function(e) {
				$('#bsmd .bsmd-preview').html(marked(editor.getValue()));
			});

			function addLine(editor, num) {
				for (var i = 0; i < num; i++) {
					editor.getSession().getDocument().insertNewLine(editor.getSelection().getCursor());
				};
			}

			function addText(editor, text) {
				editor.getSession().getDocument().insertInLine(editor.getSelection().getCursor(), text);
			}

			function reText(editor, from, to) {
				var p = editor.getSelection().getCursor();
				editor.gotoLine(p.row + 1, p.column - from, false);
				editor.getSelection().selectTo(p.row, p.column - to);
			}

			$(function() {
				$('#bsmd .bsmd-btn-bold').click(function() {
					//粗体
					addText(editor, '**粗体**');
					reText(editor, 2, 4);
					editor.focus();
				});

				$('#bsmd .bsmd-btn-italic').click(function() {
					//斜体
					addText(editor, '*斜体*');
					reText(editor, 1, 3);
					editor.focus();
				});

				$('#bsmd form.bsmd-form-link').submit(function() {
					//链接
					var lform = $(this)[0];
					addText(editor, '[' + lform.title.value + '](' + lform.url.value + ' "' + lform.title.value + '")');
					$(this).modal('hide');
					editor.focus();
					return false;
				});

				$('#bsmd .bsmd-btn-quote').click(function() {
					//引用
					addLine(editor, 2);
					addText(editor, '>');
					editor.focus();
				});

				$('#bsmd a.bsmd-code').each(function(index) {
					//代码
					$(this).click(function() {
						var lang = $(this).attr('lang');
						if ('none' == lang) {
							addText(editor, '`代码`');
							reText(editor, 1, 3);
						} else {
							addLine(editor, 2);
							addText(editor, '```' + lang);
							addLine(editor, 2);
							addText(editor, '```');
							editor.gotoLine(editor.getSelection().getCursor().row, 0, false);
						}
						editor.focus();
					});
				});

				$('#bsmd form.bsmd-form-picture').submit(function() {
					//图片
					var pform = $(this)[0];
					addText(editor, '![Alt ' + pform.title.value + '](' + pform.url.value + ' "' + pform.title.value + '")');
					$(this).modal('hide');
					editor.focus();
					return false;
				});

				$('#bsmd .bsmd-btn-ol').click(function() {
					//有序列表
					addLine(editor, 2);
					addText(editor, '0. ');
					editor.focus();
				});

				$('#bsmd .bsmd-btn-ul').click(function() {
					//无序列表
					addLine(editor, 2);
					addText(editor, '+ ');
					editor.focus();
				});

				$('#bsmd a.bsmd-header').each(function(index) {
					//标题
					$(this).click(function() {
						var c = '';

						for (var i = 0; i < (index + 1); i++) {
							c += '#';
						};

						addText(editor, c + (index + 1) + '级标题' + c);
						reText(editor, index + 1, index + 5);
						editor.focus();
					});
				});

				$('#bsmd .bsmd-btn-ellipsis').click(function() {
					//分割线
					addLine(editor, 2);
					addText(editor, '-------');
					addLine(editor, 2);
					editor.focus();
				});

				$('#bsmd .bsmd-btn-undo').click(function() {
					//撤消
					editor.undo();
				});

				$('#bsmd .bsmd-btn-redo').click(function() {
					//重置
					editor.redo();
				});
			});
        </script>
    </body>
</html>
